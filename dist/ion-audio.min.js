function Time(){return function(i){i=i||0;var n=parseInt(i,10),o=function(i){return 10>i?"0"+i:i};return o(Math.floor(n/60))+":"+o(n%60)}}function Duration(i){return function(n){return n>0?i("time")(n):""}}function MediaManager(i,n,o){function r(i,n,o,r,t){return i.url?(angular.extend(i,{onSuccess:n,onError:o,onStatusChange:r,onProgress:t,status:0,duration:-1,progress:0}),i.id=C.push(i)-1,i.id):void console.log("ionic-audio: missing track url")}function t(i){if(A){if(A.id==i)return void(A.status==Media.MEDIA_RUNNING?a():s());A.id>-1&&d()}n(function(){c(C[i])},300)}function a(){console.log("ionic-audio: pausing track "+A.title),h.pause(),v()}function e(i){h&&h.seekTo(1e3*i)}function u(){v(),g()}function c(i){A=i,console.log("ionic-audio: playing track "+A.title),h=l(A),h.play(),m()}function s(){console.log("ionic-audio: resuming track "+A.title),h.play(),m()}function d(){console.log("ionic-audio: stopping track "+A.title),h.stop(),A=void 0}function l(i){return i.url?new Media(i.url,angular.bind(i,f),angular.bind(i,k),angular.bind(i,p)):void console.log("ionic-audio: missing track url")}function g(){angular.isDefined(h)&&(h.release(),h=void 0,A=void 0)}function f(){v(),g(),angular.isFunction(this.onSuccess)&&this.onSuccess()}function k(){angular.isFunction(this.onError)&&this.onError()}function p(i){this.status=i,angular.isFunction(this.onStatusChange)&&this.onStatusChange(i)}function v(){angular.isDefined(y)&&(i.cancel(y),y=void 0)}function m(){angular.isDefined(y)||A&&(y=i(function(){A.duration<0&&(A.duration=h.getDuration()),h.getCurrentPosition(function(i){i>-1&&(A.progress=i)},function(i){console.log("Error getting pos="+i)}),angular.isFunction(A.onProgress)&&A.onProgress(A.progress,A.duration)},1e3))}var A,h,y,C=[];return o.cordova||o.Media?{add:r,play:t,pause:a,seekTo:e,destroy:u}:(console.log("ionic-audio: missing Cordova Media plugin. Have you installed the plugin? \nRun 'ionic plugin add org.apache.cordova.media'"),null)}function ionAudioTrack(){function i(i,n,o,r){r.hasOwnProgressBar=n.find("ion-audio-progress-bar").length>0,i.$on("$destroy",function(){MediaManager.destroy()})}return{transclude:!0,template:"<ng-transclude></ng-transclude>",restrict:"E",scope:{track:"="},controller:"ionAudioTrackCtrl",link:i}}function ionAudioProgress(){return{restrict:"E",scope:{track:"="},template:"{{track.progress | time}}"}}function ionAudioProgressBar(i){function n(n,o,r,t){var a,e=o.find("input");n.track={progress:0,status:0,duration:-1},angular.isDefined(r.displayTime)||(o.find("ion-audio-progress").remove(),o.find("ion-audio-duration").remove()),angular.isDefined(r.displayInfo)||o.find("h2").remove(),n.displayTrackInfo=function(){return{visibility:angular.isDefined(r.displayInfo)&&(n.track.title||n.track.artist)?"visible":"hidden"}};var u=n.$watch("track.status",function(i){e.prop("disabled",0==i)});t?n.track=t.getTrack():a=n.$on("ionic-audio:trackChange",function(i,o){n.track=o}),n.sliderRelease=function(){var o=n.track.progress;i.seekTo(o)},n.$on("$destroy",function(){u(),angular.isDefined(a)&&a()})}return{restrict:"E",template:'<h2 class="ion-audio-track-info" ng-style="displayTrackInfo()">{{track.title}} - {{track.artist}}</h2><div class="range"><ion-audio-progress track="track"></ion-audio-progress><input type="range" name="volume" min="0" max="{{track.duration}}" ng-model="track.progress" on-release="sliderRelease()" disabled><ion-audio-duration track="track"></ion-audio-duration></div>',require:"?^^ionAudioTrack",scope:{},link:n}}function ionAudioPlay(){function i(i,n,o,r){var t,a=0;i.track=r[0].getTrack();var e=r[1],u=function(){t=!1,n.addClass("ion-play"),n.removeClass("ion-pause"),n.text(o.textPlay)},c=function(){o.textPlay&&o.textPause&&n.text(n.text()==o.textPlay?o.textPause:o.textPlay)},s=function(){n.toggleClass("ion-play ion-pause"),c()};n.on("click",function(){t||(e.playTrack(),s(),0==a&&(t=!0))});var d=i.$watch("track.status",function(i){0==i||4==i?u():2==i&&(t=!1),a=i});u(),i.$on("$destroy",function(){d()})}return{restrict:"A",require:["^^ionAudioTrack","^^ionAudioControls"],link:i}}function ionAudioDuration(){return{restrict:"E",scope:{track:"="},template:"{{track.duration | duration}}"}}function ionAudioControls(){function i(i,n,o,r){var t=r[1];r[0].play=t.play,i.track=t.getTrack()}return{restrict:"EA",scope:{},require:["ionAudioControls","^^ionAudioTrack"],controller:"ionAudioControlsCtrl",link:i}}function ionAudioTrackCtrl(i,n,o){var r=this;i.track.progress=0,i.track.status=0,i.track.duration=-1;var t=function(){i.track.status=0,i.track.progress=0},a=function(n){i.track.status=n},e=function(n,o){i.track.progress=n,i.track.duration=o},u=function(){n.$broadcast("ionic-audio:trackChange",i.track)};this.seekTo=function(i){o.seekTo(i)},this.play=function(){return o?(o.play(i.track.id),r.hasOwnProgressBar||u(),i.track.id):void 0},this.getTrack=function(){return i.track},o&&(i.track.id=o.add(i.track,t,null,a,e))}function ionAudioControlsCtrl(i,n){var o,r=n.find("ion-spinner"),t=this;r.addClass("ng-hide"),this.toggleSpinner=function(){r.toggleClass("ng-hide")},this.playTrack=function(){o||t.toggleSpinner(),t.play()};var a=i.$watch("track.status",function(i){switch(i){case 1:o=!1;break;case 2:o||(t.toggleSpinner(),o=!0);break;case 0:case 4:o=!1}});i.$on("$destroy",function(){a()})}angular.module("ionic-audio",["ionic"]),angular.module("ionic-audio").filter("time",Time),angular.module("ionic-audio").filter("duration",Duration),Duration.$inject=["$filter"],angular.module("ionic-audio").factory("MediaManager",MediaManager),MediaManager.$inject=["$interval","$timeout","$window"],angular.module("ionic-audio").directive("ionAudioTrack",ionAudioTrack),angular.module("ionic-audio").directive("ionAudioProgress",ionAudioProgress),angular.module("ionic-audio").directive("ionAudioProgressBar",ionAudioProgressBar),ionAudioProgressBar.$inject=["MediaManager"],angular.module("ionic-audio").directive("ionAudioPlay",ionAudioPlay),angular.module("ionic-audio").directive("ionAudioDuration",ionAudioDuration),angular.module("ionic-audio").directive("ionAudioControls",ionAudioControls),angular.module("ionic-audio").controller("ionAudioTrackCtrl",ionAudioTrackCtrl),ionAudioTrackCtrl.$inject=["$scope","$rootScope","MediaManager"],angular.module("ionic-audio").controller("ionAudioControlsCtrl",ionAudioControlsCtrl),ionAudioControlsCtrl.$inject=["$scope","$element"];