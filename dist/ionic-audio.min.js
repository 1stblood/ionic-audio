function Time(){return function(i){i=i||0;var n=parseInt(i,10),o=function(i){return 10>i?"0"+i:i};return o(Math.floor(n/60))+":"+o(n%60)}}function Duration(){return function(i){return i>0?$filter("time")(i):""}}function MediaManager(i,n,o){function r(i,n,o,r,a){return i.url?(angular.extend(i,{onSuccess:n,onError:o,onStatusChange:r,onProgress:a,status:0,duration:-1,progress:0}),i.id=C.push(i)-1,i.id):void console.log("ionic-audio: missing track url")}function a(i){if(h){if(h.id==i)return void(h.status==Media.MEDIA_RUNNING?t():s());h.id>-1&&d()}n(function(){c(C[i])},300)}function t(){h&&(console.log("ionic-audio: pausing track "+h.title),y.pause(),v())}function e(i){y&&y.seekTo(1e3*i)}function u(){v(),g()}function c(i){h&&(h=i,console.log("ionic-audio: playing track "+h.title),y=l(h),y.play(),m())}function s(){console.log("ionic-audio: resuming track "+h.title),y.play(),m()}function d(){console.log("ionic-audio: stopping track "+h.title),y.stop(),h=void 0}function l(i){return i.url?new Media(i.url,angular.bind(i,f),angular.bind(i,k),angular.bind(i,p)):void console.log("ionic-audio: missing track url")}function g(){angular.isDefined(y)&&(y.release(),y=void 0,h=void 0)}function f(){v(),g(),angular.isFunction(this.onSuccess)&&this.onSuccess()}function k(){angular.isFunction(this.onError)&&this.onError()}function p(i){this.status=i,angular.isFunction(this.onStatusChange)&&this.onStatusChange(i)}function v(){angular.isDefined(A)&&(i.cancel(A),A=void 0)}function m(){angular.isDefined(A)||h&&(A=i(function(){h.duration<0&&(h.duration=y.getDuration()),y.getCurrentPosition(function(i){i>-1&&(h.progress=i)},function(i){console.log("Error getting pos="+i)}),angular.isFunction(h.onProgress)&&h.onProgress(h.progress,h.duration)},1e3))}var h,y,A,C=[];return o.cordova||o.Media?{add:r,play:a,pause:t,seekTo:e,destroy:u}:(console.log("ionic-audio: missing Cordova Media plugin. Have you installed the plugin? \nRun 'ionic plugin add org.apache.cordova.media'"),null)}function ionAudioTrack(){function i(i,n,o,r){r.hasOwnProgressBar=n.find("ion-audio-progress-bar").length>0,i.$on("$destroy",function(){MediaManager.destroy()})}return{transclude:!0,template:"<ng-transclude></ng-transclude>",restrict:"E",scope:{track:"="},controller:"ionAudioTrackCtrl",link:i}}function ionAudioProgress(){return{restrict:"E",scope:{track:"="},template:"{{track.progress | time}}"}}function ionAudioProgressBar(){function i(i,n,o,r){var a,t=n.find("input");i.track={progress:0,status:0,duration:-1},angular.isDefined(o.displayTime)||(n.find("ion-audio-progress").remove(),n.find("ion-audio-duration").remove()),angular.isDefined(o.displayInfo)||n.find("h2").remove(),i.displayTrackInfo=function(){return{visibility:angular.isDefined(o.displayInfo)&&(i.track.title||i.track.artist)?"visible":"hidden"}};var e=i.$watch("track.status",function(i){t.prop("disabled",0==i)});r?i.track=r.getTrack():a=i.$on("ionic-audio:trackChange",function(n,o){i.track=o}),i.sliderRelease=function(){var n=i.track.progress;MediaManager.seekTo(n)},i.$on("$destroy",function(){e(),angular.isDefined(a)&&a()})}return{restrict:"E",template:'<h2 class="ion-audio-track-info" ng-style="displayTrackInfo()">{{track.title}} - {{track.artist}}</h2><div class="range"><ion-audio-progress track="track"></ion-audio-progress><input type="range" name="volume" min="0" max="{{track.duration}}" ng-model="track.progress" on-release="sliderRelease()" disabled><ion-audio-duration track="track"></ion-audio-duration></div>',require:"?^^ionAudioTrack",scope:{},link:i}}function ionAudioPlay(){function i(i,n,o,r){var a,t=0;i.track=r[0].getTrack();var e=r[1],u=function(){a=!1,n.addClass("ion-play"),n.removeClass("ion-pause"),n.text(o.textPlay)},c=function(){o.textPlay&&o.textPause&&n.text(n.text()==o.textPlay?o.textPause:o.textPlay)},s=function(){n.toggleClass("ion-play ion-pause"),c()};n.on("click",function(){a||(e.playTrack(),s(),0==t&&(a=!0))});var d=i.$watch("track.status",function(i){0==i||4==i?u():2==i&&(a=!1),t=i});u(),i.$on("$destroy",function(){d()})}return{restrict:"A",require:["^^ionAudioTrack","^^ionAudioControls"],link:i}}function ionAudioDuration(){return{restrict:"E",scope:{track:"="},template:"{{track.duration | duration}}"}}function ionAudioControls(){function i(i,n,o,r){var a=r[1];r[0].play=a.play,i.track=a.getTrack()}return{restrict:"EA",scope:{},require:["ionAudioControls","^^ionAudioTrack"],controller:"ionAudioControlsCtrl",link:i}}function ionAudioTrackCtrl(i){var n=this;i.track.progress=0,i.track.status=0,i.track.duration=-1;var o=function(){i.track.status=0,i.track.progress=0},r=function(n){i.track.status=n},a=function(n,o){i.track.progress=n,i.track.duration=o},t=function(){$rootScope.$broadcast("ionic-audio:trackChange",i.track)};this.seekTo=function(i){MediaManager.seekTo(i)},this.play=function(){return MediaManager?(MediaManager.play(i.track.id),n.hasOwnProgressBar||t(),i.track.id):void 0},this.getTrack=function(){return i.track},MediaManager&&(i.track.id=MediaManager.add(i.track,o,null,r,a))}function ionAudioControlsCtrl(i,n){var o,r=n.find("ion-spinner"),a=this;r.addClass("ng-hide"),this.toggleSpinner=function(){r.toggleClass("ng-hide")},this.playTrack=function(){o||a.toggleSpinner(),a.play()};var t=i.$watch("track.status",function(i){switch(i){case 1:o=!1;break;case 2:o||(a.toggleSpinner(),o=!0);break;case 0:case 4:o=!1}});i.$on("$destroy",function(){t()})}angular.module("ionic-audio",["ionic"]),angular.module("ionic-audio").filter("time",Time),angular.module("ionic-audio").filter("duration",Duration),angular.module("ionic-audio").factory("MediaManager",MediaManager),MediaManager.$inject=["$interval","$timeout","$window"],angular.module("ionic-audio").directive("ionAudioTrack",ionAudioTrack),angular.module("ionic-audio").directive("ionAudioProgress",ionAudioProgress),angular.module("ionic-audio").directive("ionAudioProgressBar",ionAudioProgressBar),angular.module("ionic-audio").directive("ionAudioPlay",ionAudioPlay),angular.module("ionic-audio").directive("ionAudioDuration",ionAudioDuration),angular.module("ionic-audio").directive("ionAudioControls",ionAudioControls),angular.module("ionic-audio").controller("ionAudioTrackCtrl",ionAudioTrackCtrl),ionAudioTrackCtrl.$inject=["$scope"],angular.module("ionic-audio").controller("ionAudioControlsCtrl",ionAudioControlsCtrl),ionAudioControlsCtrl.$inject=["$scope","$element"];